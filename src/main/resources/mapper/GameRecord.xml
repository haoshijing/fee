<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yingliguoji.fee.dao.GameRecordMapper">

    <sql id="tableName">
        game_record
    </sql>
    <!-- 插入一条记录 -->

    <select id = "selectAll" resultType="com.yingliguoji.fee.po.GameRecordPo" >
        select * from  <include refid="tableName"/>

    </select>

    <update id="updateReAmount">
        update <include refid="tableName"/> SET
         reAmount = netAmount - betAmount
        where reAmount = 0
    </update>
    <select id="getPlayerTotal" resultType="java.math.BigDecimal">
        select COALESCE(  sum(reAmount),0) from <include refid="tableName" />
        where
        member_id =#{memberId}
        <if test = "gameTypes != null and gameTypes.size() > 0">
            AND gameType in
            <foreach collection="gameTypes" close=")" open="(" separator="," item="type">
                #{type}
            </foreach>

        </if>

        <if test = "start != null and start != ''">
            AND created_at >= #{start}
        </if>

        <if test = "end != null and end != ''">
            AND created_at <![CDATA[ <= ]]> #{end}
        </if>
        and reAmount <![CDATA[  <> 0]]>
    </select>


    <select id="queryByTradeNo" parameterType="java.lang.String" resultType="java.lang.Integer">
        select count(1) from <include refid="tableName" />
        where billNo = #{tradeNo}
    </select>

    <select id="getValidBetTotal" resultType="java.math.BigDecimal">
        select COALESCE( sum(validBetAmount) ,0) from <include refid="tableName" />
        where member_id in
        <foreach collection="memberIds" item="memberId" separator="," open="(" close=")">
            #{memberId}
        </foreach>
        <if test = "gameTypes != null and gameTypes.size() > 0">
            AND gameType in
            <foreach collection="gameTypes" close=")" open="(" separator="," item="type">
                #{type}
            </foreach>

        </if>

        <if test = "start != null and start != ''">
            AND created_at >= #{start}
        </if>

        <if test = "end != null and end != ''">
            AND created_at <![CDATA[ <= ]]> #{end}
        </if>
        and reAmount <![CDATA[  <> 0]]>
     </select>

    <select id="getReAmountTotal" resultType="java.math.BigDecimal">
        select COALESCE( sum(reAmount),0) from <include refid="tableName" />
        where member_id in
        <foreach collection="memberIds" item="memberId" separator="," open="(" close=")">
            #{memberId}
        </foreach>
        <if test = "gameTypes != null and gameTypes.size() > 0">
            AND gameType in
            <foreach collection="gameTypes" close=")" open="(" separator="," item="type">
                #{type}
            </foreach>
        </if>

        <if test = "start != null and start != ''">
            AND created_at >= #{start}
        </if>

        <if test = "end != null and end != ''">
            AND created_at <![CDATA[ <= ]]> #{end}
        </if>
        and reAmount <![CDATA[  <> 0]]>
    </select>


    <insert id="insert" parameterType="com.yingliguoji.fee.po.GameRecordPo">
        INSERT INTO <include refid="tableName"/>
        (
        rowid,
        api_type,
        netAmount,
        billNo,
        api_type,
        playerName,
        `name`,
        member_id,
        gameCode,
        betTime,
        gameType,
        betAmount,
        validBetAmount,
        reAmount,
        created_at,
        updated_at
        )
        VALUES
        (
        0,
        35,
        #{netAmount},
        #{billNo},
        8,
        #{name},
        #{name},
        #{memberId},
        'YLCP',
        #{betTime},
        #{gameType},
        #{betAmount},
        #{betAmount},
        #{reAmount},
        #{created_at},
        #{updated_at}
        )
    </insert>
</mapper>